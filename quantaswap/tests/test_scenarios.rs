#![allow(dead_code)]
// use rand::Rng;
use scrypto::prelude::*;
use ::quantaswap::tick::Tick;

mod common;
pub use crate::common::vars::*;
pub use crate::common::setup::*;
pub use crate::common::misc::*;
pub use crate::common::quantaswap::*;
pub use crate::common::fee_controller;

#[test]
fn test_repeated_max_swaps() {
    let mut vars = setup();
    fee_controller::set_protocol_fee_default_zero(&mut vars);
    fee_controller::set_liquidity_fee_default(5, &mut vars);

    let id = mint_liquidity_receipt(&mut vars);
    let tick = Tick::MAX.0;
    let amount_x = dec!(0);
    let amount_y = dec!(10);
    add_liquidity_to_receipt(id, amount_x, amount_y, vec![(tick, amount_x, amount_y)], &mut vars).expect_commit_success();

    let balance_x0 = get_balance(vars.token_x, &mut vars);
    let balance_y0 = get_balance(vars.token_y, &mut vars);
    let amount_x0 = get_amount_x(&mut vars);
    let amount_y0 = get_amount_y(&mut vars);

    for _ in 0..17 {
        swap(vars.token_x, dec!(1000000000000000), &mut vars).expect_commit_success();
        swap(vars.token_y, dec!(1000000000000000), &mut vars).expect_commit_success();
    }

    let balance_x1 = get_balance(vars.token_x, &mut vars);
    let balance_y1 = get_balance(vars.token_y, &mut vars);
    let amount_x1 = get_amount_x(&mut vars);
    let amount_y1 = get_amount_y(&mut vars);

    println!("balance_x0: {}, balance_x1: {}, difference: {}", balance_x0, balance_x1, balance_x1 - balance_x0);
    println!("balance_y0: {}, balance_y1: {}, difference: {}", balance_y0, balance_y1, balance_y1 - balance_y0);
    println!("amount_x0: {}, amount_x1: {}, difference: {}", amount_x0, amount_x1, amount_x1 - amount_x0);
    println!("amount_y0: {}, amount_y1: {}, difference: {}", amount_y0, amount_y1, amount_y1 - amount_y0);

    assert!(balance_x1 <= balance_x0);
    assert!(balance_y1 <= balance_y0);
    assert!(amount_x1 >= amount_x0);
    assert!(amount_y1 >= amount_y0);
}

#[test]
fn test_repeated_swaps() {
    let mut vars = setup();
    fee_controller::set_protocol_fee_default_zero(&mut vars);
    fee_controller::set_liquidity_fee_default_zero(&mut vars);

    let id = mint_liquidity_receipt(&mut vars);
    let tick = Tick::MAX.0;
    let amount_x = dec!(0);
    let amount_y = dec!(1000000000000000);
    add_liquidity_to_receipt(id, amount_x, amount_y, vec![(tick, amount_x, amount_y)], &mut vars).expect_commit_success();
    let price = get_price(&mut vars).unwrap();

    let balance_x0 = get_balance(vars.token_x, &mut vars);
    let balance_y0 = get_balance(vars.token_y, &mut vars);
    let amount_x0 = get_amount_x(&mut vars);
    let amount_y0 = get_amount_y(&mut vars);

    let swap_amount = dec!("0.001");
    for _ in 0..17 {
        swap(vars.token_x, round_up(swap_amount, vars.divisibility_x), &mut vars).expect_commit_success();
        println!("amount_y: {}", get_amount_y(&mut vars));
        assert!(get_amount_y(&mut vars) > dec!(0));
        swap(vars.token_y, round_up(swap_amount * price * dec!("0.99"), vars.divisibility_y), &mut vars).expect_commit_success();
        assert!(get_amount_x(&mut vars) > dec!(0));
    }
    swap(vars.token_y, dec!(100000000000000000), &mut vars).expect_commit_success();

    let balance_x1 = get_balance(vars.token_x, &mut vars);
    let balance_y1 = get_balance(vars.token_y, &mut vars);
    let amount_x1 = get_amount_x(&mut vars);
    let amount_y1 = get_amount_y(&mut vars);

    println!("balance_x0: {}, balance_x1: {}, difference: {}", balance_x0, balance_x1, balance_x1 - balance_x0);
    println!("balance_y0: {}, balance_y1: {}, difference: {}", balance_y0, balance_y1, balance_y1 - balance_y0);
    println!("amount_x0: {}, amount_x1: {}, difference: {}", amount_x0, amount_x1, amount_x1 - amount_x0);
    println!("amount_y0: {}, amount_y1: {}, difference: {}", amount_y0, amount_y1, amount_y1 - amount_y0);

    assert!(balance_x1 <= balance_x0);
    assert!(balance_y1 <= balance_y0);
    assert!(amount_x1 >= amount_x0);
    assert!(amount_y1 >= amount_y0);
}

#[test]
fn test_scenario_1() {
    let mut vars = setup();
    fee_controller::set_protocol_fee_default_zero(&mut vars);
    fee_controller::set_liquidity_fee_default_zero(&mut vars);

    let id1 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id1.clone(), dec!(3.859313353604427864), dec!(150976.244312679542238700), vec![(37900, dec!(0.032160944613370236), dec!(0.000000000000000000)), (37880, dec!(0.064321889226740460), dec!(0.000000000000000000)), (37860, dec!(0.096482833840110696), dec!(0.000000000000000000)), (37840, dec!(0.128643778453480932), dec!(0.000000000000000000)), (37820, dec!(0.160804723066851160), dec!(0.000000000000000000)), (37800, dec!(0.192965667680221392), dec!(0.000000000000000000)), (37780, dec!(0.225126612293591628), dec!(0.000000000000000000)), (37760, dec!(0.257287556906961856), dec!(0.000000000000000000)), (37740, dec!(0.289448501520332088), dec!(0.000000000000000000)), (37720, dec!(0.321609446133702324), dec!(0.000000000000000000)), (37700, dec!(0.353770390747072552), dec!(0.000000000000000000)), (37680, dec!(0.385931335360442788), dec!(0.000000000000000000)), (37660, dec!(0.418092279973813020), dec!(0.000000000000000000)), (37640, dec!(0.450253224587183248), dec!(0.000000000000000000)), (37620, dec!(0.482414169200553484), dec!(0.000000000000000000)), (37600, dec!(0.000000000000000000), dec!(13874.137425882242538000)), (37580, dec!(0.000000000000000000), dec!(18280.280918239639839000)), (37560, dec!(0.000000000000000000), dec!(16974.546566936808638000)), (37540, dec!(0.000000000000000000), dec!(15668.812215633977135000)), (37520, dec!(0.000000000000000000), dec!(14363.077864331145631000)), (37500, dec!(0.000000000000000000), dec!(13057.343513028314430000)), (37480, dec!(0.000000000000000000), dec!(11751.609161725482775000)), (37460, dec!(0.000000000000000000), dec!(10445.874810422651272000)), (37440, dec!(0.000000000000000000), dec!(9140.140459119820070600)), (37420, dec!(0.000000000000000000), dec!(7834.406107816988567300)), (37400, dec!(0.000000000000000000), dec!(6528.671756514157063900)), (37380, dec!(0.000000000000000000), dec!(5222.937405211325862500)), (37360, dec!(0.000000000000000000), dec!(3917.203053908494208200)), (37340, dec!(0.000000000000000000), dec!(2611.468702605662704800)), (37320, dec!(0.000000000000000000), dec!(1305.734351302831503400))], &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(499.850000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(499.850000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(7306.753443471368790054), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.177501785446691202), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(999.700000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.029991000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.069979000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.414875500000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.449865000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.492852100000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(1119.664000000000000000), &mut vars).expect_commit_success(); 

    let id2 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id2.clone(), dec!(0.029234377749017794), dec!(1219.745836574430518380), vec![(37680, dec!(0.000955562094744499), dec!(0.000000000000000000)), (37660, dec!(0.001911124189488998), dec!(0.000000000000000000)), (37640, dec!(0.002866686284233497), dec!(0.000000000000000000)), (37620, dec!(0.003822248378977996), dec!(0.000000000000000000)), (37540, dec!(0.002478639096171822), dec!(197.375832021779030980)), (37600, dec!(0.004777810473722495), dec!(0.000000000000000000)), (37580, dec!(0.005733372568466994), dec!(0.000000000000000000)), (37560, dec!(0.006688934663211493), dec!(0.000000000000000000)), (37520, dec!(0.000000000000000000), dec!(255.592501138162871850)), (37500, dec!(0.000000000000000000), dec!(219.079286689853890680)), (37480, dec!(0.000000000000000000), dec!(182.566072241544908290)), (37460, dec!(0.000000000000000000), dec!(146.052857793235927120)), (37440, dec!(0.000000000000000000), dec!(109.539643344926944730)), (37420, dec!(0.000000000000000000), dec!(73.026428896617963560)), (37400, dec!(0.000000000000000000), dec!(36.513214448308981170))], &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(249.925000000000000000), &mut vars).expect_commit_success(); 

    let id3 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id3.clone(), dec!(0.006520449385053222), dec!(274.267272325461416187), vec![(37680, dec!(0.000213998522627577), dec!(0.000000000000000000)), (37660, dec!(0.000427997045255154), dec!(0.000000000000000000)), (37640, dec!(0.000641995567882731), dec!(0.000000000000000000)), (37620, dec!(0.000855994090510308), dec!(0.000000000000000000)), (37600, dec!(0.001069992613137885), dec!(0.000000000000000000)), (37580, dec!(0.001283991135765463), dec!(0.000000000000000000)), (37560, dec!(0.001497989658393040), dec!(0.000000000000000000)), (37540, dec!(0.000528490751481064), dec!(45.235774632389562917)), (37520, dec!(0.000000000000000000), dec!(57.257874423267963318)), (37500, dec!(0.000000000000000000), dec!(49.078178077086825583)), (37480, dec!(0.000000000000000000), dec!(40.898481730905688123)), (37460, dec!(0.000000000000000000), dec!(32.718785384724550389)), (37440, dec!(0.000000000000000000), dec!(24.539089038543412929)), (37420, dec!(0.000000000000000000), dec!(16.359392692362275194)), (37400, dec!(0.000000000000000000), dec!(8.179696346181137734))], &mut vars).expect_commit_success();
    swap(vars.token_y, dec!(249.925000000000000000), &mut vars).expect_commit_success(); 

    let id4 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id4.clone(), dec!(0.006517952280574452), dec!(276.383516624961412108), vec![(37680, dec!(0.000214790687301436), dec!(0.000000000000000000)), (37660, dec!(0.000429581374602872), dec!(0.000000000000000000)), (37640, dec!(0.000644372061904308), dec!(0.000000000000000000)), (37620, dec!(0.000859162749205743), dec!(0.000000000000000000)), (37600, dec!(0.001073953436507179), dec!(0.000000000000000000)), (37580, dec!(0.001288744123808615), dec!(0.000000000000000000)), (37560, dec!(0.001503534811110051), dec!(0.000000000000000000)), (37540, dec!(0.000503813036134248), dec!(46.432914642068698905)), (37520, dec!(0.000000000000000000), dec!(57.487650495723178301)), (37500, dec!(0.000000000000000000), dec!(49.275128996334152908)), (37480, dec!(0.000000000000000000), dec!(41.062607496945127239)), (37460, dec!(0.000000000000000000), dec!(32.850085997556101847)), (37440, dec!(0.000000000000000000), dec!(24.637564498167076454)), (37420, dec!(0.000000000000000000), dec!(16.425042998778051061)), (37400, dec!(0.000000000000000000), dec!(8.212521499389025393))], &mut vars).expect_commit_success(); 
    remove_liquidity(id4.clone(), &mut vars).expect_commit_success(); 
    remove_liquidity(id3.clone(), &mut vars).expect_commit_success(); 
    remove_liquidity(id2.clone(), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.041995548536310596), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(9997.000000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(3998.800000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(1999.400000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(9997.000000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(9997.000000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(4998.500000000000000000), &mut vars).expect_commit_success(); 

    println!("{:?}", get_active_tick(&mut vars));
    remove_liquidity(id1.clone(), &mut vars).expect_commit_success(); 

    println!("ABOVE:\n\n{:?}\n", get_bins_above(None, None, Some(10), &mut vars));
    println!("BELOW:\n\n{:?}\n", get_bins_below(None, None, Some(10), &mut vars));
    println!("{:?}", get_active_tick(&mut vars));
    println!("{:?}", get_active_amounts(&mut vars));
    let id5 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id5.clone(), dec!(0.498210000000000000), dec!(19856.580147000000000000), vec![(37600, dec!(0.049821000000000000), dec!(0.000000000000000000)), (37780, dec!(0.049821000000000000), dec!(0.000000000000000000)), (37760, dec!(0.049821000000000000), dec!(0.000000000000000000)), (37740, dec!(0.049821000000000000), dec!(0.000000000000000000)), (37720, dec!(0.049821000000000000), dec!(0.000000000000000000)), (37700, dec!(0.049821000000000000), dec!(0.000000000000000000)), (37680, dec!(0.049821000000000000), dec!(0.000000000000000000)), (37660, dec!(0.049821000000000000), dec!(0.000000000000000000)), (37640, dec!(0.049821000000000000), dec!(0.000000000000000000)), (37620, dec!(0.049821000000000000), dec!(0.000000000000000000)), (37580, dec!(0.000000000000000000), dec!(1921.126050000000000000)), (37560, dec!(0.000000000000000000), dec!(1992.828233000000000000)), (37540, dec!(0.000000000000000000), dec!(1992.828233000000000000)), (37520, dec!(0.000000000000000000), dec!(1992.828233000000000000)), (37500, dec!(0.000000000000000000), dec!(1992.828233000000000000)), (37480, dec!(0.000000000000000000), dec!(1992.828233000000000000)), (37460, dec!(0.000000000000000000), dec!(1992.828233000000000000)), (37440, dec!(0.000000000000000000), dec!(1992.828233000000000000)), (37420, dec!(0.000000000000000000), dec!(1992.828233000000000000)), (37400, dec!(0.000000000000000000), dec!(1992.828233000000000000))], &mut vars).expect_commit_success(); 
    println!("ABOVE:\n\n{:?}\n", get_bins_above(None, None, Some(10), &mut vars));
    println!("BELOW:\n\n{:?}\n", get_bins_below(None, None, Some(10), &mut vars));
    println!("{:?}", get_active_tick(&mut vars));
    println!("{:?}", get_active_amounts(&mut vars));
    println!("{:?}", get_liquidity_claims(id5.clone(), &mut vars));

    let id6 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id6.clone(), dec!(0.007457799868670488), dec!(290.666124000000000000), vec![(37740, dec!(0.000625000000000000), dec!(0.000000000000000000)), (37600, dec!(0.000265799868670488), dec!(1.881772000000000000)), (37720, dec!(0.000938000000000000), dec!(0.000000000000000000)), (37700, dec!(0.001251000000000000), dec!(0.000000000000000000)), (37680, dec!(0.001564000000000000), dec!(0.000000000000000000)), (37660, dec!(0.001251000000000000), dec!(0.000000000000000000)), (37640, dec!(0.000938000000000000), dec!(0.000000000000000000)), (37620, dec!(0.000625000000000000), dec!(0.000000000000000000)), (37580, dec!(0.000000000000000000), dec!(25.111518000000000000)), (37560, dec!(0.000000000000000000), dec!(37.667714000000000000)), (37540, dec!(0.000000000000000000), dec!(50.223328000000000000)), (37520, dec!(0.000000000000000000), dec!(62.779232000000000000)), (37500, dec!(0.000000000000000000), dec!(50.223328000000000000)), (37480, dec!(0.000000000000000000), dec!(37.667714000000000000)), (37460, dec!(0.000000000000000000), dec!(25.111518000000000000))], &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(249.925000000000000000), &mut vars).expect_commit_success(); 

    let id7 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id7.clone(), dec!(0.006189444060605737), dec!(198.383318000000000000), vec![(37660, dec!(0.000695000000000000), dec!(0.000000000000000000)), (37640, dec!(0.001390000000000000), dec!(0.000000000000000000)), (37620, dec!(0.002085000000000000), dec!(0.000000000000000000)), (37600, dec!(0.002019444060605737), dec!(30.584192000000000000)), (37580, dec!(0.000000000000000000), dec!(83.899563000000000000)), (37560, dec!(0.000000000000000000), dec!(55.933042000000000000)), (37540, dec!(0.000000000000000000), dec!(27.966521000000000000))], &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(249.925000000000000000), &mut vars).expect_commit_success();
    swap(vars.token_y, dec!(1182.968166655745163847), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(1999.400000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(1999.400000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.024361532217498663), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(1999.400000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.012196649511026479), &mut vars).expect_commit_success(); 

    remove_liquidity(id6.clone(), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.005656856533256497), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.119964000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(4998.500000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(1099.670000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(9997.000000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.099970000000000000), &mut vars).expect_commit_success();
    swap(vars.token_x, dec!(0.289913000000000000), &mut vars).expect_commit_success(); 

    let id8 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id8.clone(), dec!(0.859999999999999975), dec!(0), vec![(37620, dec!(0.033725490196078431), dec!(0.000000000000000000)), (37640, dec!(0.033050980392156862), dec!(0.000000000000000000)), (37660, dec!(0.032376470588235294), dec!(0.000000000000000000)), (37680, dec!(0.031701960784313725), dec!(0.000000000000000000)), (37700, dec!(0.031027450980392156), dec!(0.000000000000000000)), (37720, dec!(0.030352941176470588), dec!(0.000000000000000000)), (37740, dec!(0.029678431372549019), dec!(0.000000000000000000)), (37760, dec!(0.029003921568627450), dec!(0.000000000000000000)), (37780, dec!(0.028329411764705882), dec!(0.000000000000000000)), (37800, dec!(0.027654901960784313), dec!(0.000000000000000000)), (37820, dec!(0.026980392156862745), dec!(0.000000000000000000)), (37840, dec!(0.026305882352941176), dec!(0.000000000000000000)), (37860, dec!(0.025631372549019607), dec!(0.000000000000000000)), (37880, dec!(0.024956862745098039), dec!(0.000000000000000000)), (37900, dec!(0.024282352941176470), dec!(0.000000000000000000)), (37920, dec!(0.023607843137254901), dec!(0.000000000000000000)), (37940, dec!(0.022933333333333333), dec!(0.000000000000000000)), (37960, dec!(0.022258823529411764), dec!(0.000000000000000000)), (37980, dec!(0.021584313725490196), dec!(0.000000000000000000)), (38000, dec!(0.020909803921568627), dec!(0.000000000000000000)), (38020, dec!(0.020235294117647058), dec!(0.000000000000000000)), (38040, dec!(0.019560784313725490), dec!(0.000000000000000000)), (38060, dec!(0.018886274509803921), dec!(0.000000000000000000)), (38080, dec!(0.018211764705882352), dec!(0.000000000000000000)), (38100, dec!(0.017537254901960784), dec!(0.000000000000000000)), (38120, dec!(0.016862745098039215), dec!(0.000000000000000000)), (38140, dec!(0.016188235294117647), dec!(0.000000000000000000)), (38160, dec!(0.015513725490196078), dec!(0.000000000000000000)), (38180, dec!(0.014839215686274509), dec!(0.000000000000000000)), (38200, dec!(0.014164705882352941), dec!(0.000000000000000000)), (38220, dec!(0.013490196078431372), dec!(0.000000000000000000)), (38240, dec!(0.012815686274509803), dec!(0.000000000000000000)), (38260, dec!(0.012141176470588235), dec!(0.000000000000000000)), (38280, dec!(0.011466666666666666), dec!(0.000000000000000000)), (38300, dec!(0.010792156862745098), dec!(0.000000000000000000)), (38320, dec!(0.010117647058823529), dec!(0.000000000000000000)), (38340, dec!(0.009443137254901960), dec!(0.000000000000000000)), (38360, dec!(0.008768627450980392), dec!(0.000000000000000000)), (38380, dec!(0.008094117647058823), dec!(0.000000000000000000)), (38400, dec!(0.007419607843137254), dec!(0.000000000000000000)), (38420, dec!(0.006745098039215686), dec!(0.000000000000000000)), (38440, dec!(0.006070588235294117), dec!(0.000000000000000000)), (38460, dec!(0.005396078431372549), dec!(0.000000000000000000)), (38480, dec!(0.004721568627450980), dec!(0.000000000000000000)), (38500, dec!(0.004047058823529411), dec!(0.000000000000000000)), (38520, dec!(0.003372549019607843), dec!(0.000000000000000000)), (38540, dec!(0.002698039215686274), dec!(0.000000000000000000)), (38560, dec!(0.002023529411764705), dec!(0.000000000000000000)), (38580, dec!(0.001349019607843137), dec!(0.000000000000000000)), (38600, dec!(0.000674509803921568), dec!(0.000000000000000000))], &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.455906404588774504), &mut vars).expect_commit_success(); 

    let id9 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id9.clone(), dec!(0.144696246631393456), dec!(0), vec![(37500, dec!(0.005674362612995822), dec!(0.000000000000000000)), (37520, dec!(0.005560875360735906), dec!(0.000000000000000000)), (37540, dec!(0.005447388108475989), dec!(0.000000000000000000)), (37560, dec!(0.005333900856216073), dec!(0.000000000000000000)), (37580, dec!(0.005220413603956156), dec!(0.000000000000000000)), (37600, dec!(0.005106926351696240), dec!(0.000000000000000000)), (37620, dec!(0.004993439099436324), dec!(0.000000000000000000)), (37640, dec!(0.004879951847176407), dec!(0.000000000000000000)), (37660, dec!(0.004766464594916491), dec!(0.000000000000000000)), (37680, dec!(0.004652977342656574), dec!(0.000000000000000000)), (37700, dec!(0.004539490090396658), dec!(0.000000000000000000)), (37720, dec!(0.004426002838136741), dec!(0.000000000000000000)), (37740, dec!(0.004312515585876825), dec!(0.000000000000000000)), (37760, dec!(0.004199028333616908), dec!(0.000000000000000000)), (37780, dec!(0.004085541081356992), dec!(0.000000000000000000)), (37800, dec!(0.003972053829097075), dec!(0.000000000000000000)), (37820, dec!(0.003858566576837159), dec!(0.000000000000000000)), (37840, dec!(0.003745079324577243), dec!(0.000000000000000000)), (37860, dec!(0.003631592072317326), dec!(0.000000000000000000)), (37880, dec!(0.003518104820057410), dec!(0.000000000000000000)), (37900, dec!(0.003404617567797493), dec!(0.000000000000000000)), (37920, dec!(0.003291130315537577), dec!(0.000000000000000000)), (37940, dec!(0.003177643063277660), dec!(0.000000000000000000)), (37960, dec!(0.003064155811017744), dec!(0.000000000000000000)), (37980, dec!(0.002950668558757827), dec!(0.000000000000000000)), (38000, dec!(0.002837181306497911), dec!(0.000000000000000000)), (38020, dec!(0.002723694054237994), dec!(0.000000000000000000)), (38040, dec!(0.002610206801978078), dec!(0.000000000000000000)), (38060, dec!(0.002496719549718162), dec!(0.000000000000000000)), (38080, dec!(0.002383232297458245), dec!(0.000000000000000000)), (38100, dec!(0.002269745045198329), dec!(0.000000000000000000)), (38120, dec!(0.002156257792938412), dec!(0.000000000000000000)), (38140, dec!(0.002042770540678496), dec!(0.000000000000000000)), (38160, dec!(0.001929283288418579), dec!(0.000000000000000000)), (38180, dec!(0.001815796036158663), dec!(0.000000000000000000)), (38200, dec!(0.001702308783898746), dec!(0.000000000000000000)), (38220, dec!(0.001588821531638830), dec!(0.000000000000000000)), (38240, dec!(0.001475334279378913), dec!(0.000000000000000000)), (38260, dec!(0.001361847027118997), dec!(0.000000000000000000)), (38280, dec!(0.001248359774859081), dec!(0.000000000000000000)), (38300, dec!(0.001134872522599164), dec!(0.000000000000000000)), (38320, dec!(0.001021385270339248), dec!(0.000000000000000000)), (38340, dec!(0.000907898018079331), dec!(0.000000000000000000)), (38360, dec!(0.000794410765819415), dec!(0.000000000000000000)), (38380, dec!(0.000680923513559498), dec!(0.000000000000000000)), (38400, dec!(0.000567436261299582), dec!(0.000000000000000000)), (38420, dec!(0.000453949009039665), dec!(0.000000000000000000)), (38440, dec!(0.000340461756779749), dec!(0.000000000000000000)), (38460, dec!(0.000226974504519832), dec!(0.000000000000000000)), (38480, dec!(0.000113487252259916), dec!(0.000000000000000000))], &mut vars).expect_commit_success(); 

    let id10 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id10.clone(), dec!(0.000021983368606519), dec!(2961.447076327232105428), vec![(37480, dec!(0.000021983368606519), dec!(58.067589484094334615)), (37460, dec!(0.000000000000000000), dec!(116.135179473725510833)), (37440, dec!(0.000000000000000000), dec!(113.765073770180092245)), (37420, dec!(0.000000000000000000), dec!(111.394968066634673656)), (37400, dec!(0.000000000000000000), dec!(109.024862363089255068)), (37380, dec!(0.000000000000000000), dec!(106.654756659543836479)), (37360, dec!(0.000000000000000000), dec!(104.284650955998417891)), (37340, dec!(0.000000000000000000), dec!(101.914545252452999302)), (37320, dec!(0.000000000000000000), dec!(99.544439548907580714)), (37300, dec!(0.000000000000000000), dec!(97.174333845362162125)), (37280, dec!(0.000000000000000000), dec!(94.804228141816743537)), (37260, dec!(0.000000000000000000), dec!(92.434122438271324949)), (37240, dec!(0.000000000000000000), dec!(90.064016734725906360)), (37220, dec!(0.000000000000000000), dec!(87.693911031180487772)), (37200, dec!(0.000000000000000000), dec!(85.323805327635069183)), (37180, dec!(0.000000000000000000), dec!(82.953699624089650595)), (37160, dec!(0.000000000000000000), dec!(80.583593920544232006)), (37140, dec!(0.000000000000000000), dec!(78.213488216998813418)), (37120, dec!(0.000000000000000000), dec!(75.843382513453394830)), (37100, dec!(0.000000000000000000), dec!(73.473276809907976241)), (37080, dec!(0.000000000000000000), dec!(71.103171106362557653)), (37060, dec!(0.000000000000000000), dec!(68.733065402817139064)), (37040, dec!(0.000000000000000000), dec!(66.362959699271720476)), (37020, dec!(0.000000000000000000), dec!(63.992853995726301887)), (37000, dec!(0.000000000000000000), dec!(61.622748292180883299)), (36980, dec!(0.000000000000000000), dec!(59.252642588635464710)), (36960, dec!(0.000000000000000000), dec!(56.882536885090046122)), (36940, dec!(0.000000000000000000), dec!(54.512431181544627534)), (36920, dec!(0.000000000000000000), dec!(52.142325477999208945)), (36900, dec!(0.000000000000000000), dec!(49.772219774453790357)), (36880, dec!(0.000000000000000000), dec!(47.402114070908371768)), (36860, dec!(0.000000000000000000), dec!(45.032008367362953180)), (36840, dec!(0.000000000000000000), dec!(42.661902663817534591)), (36820, dec!(0.000000000000000000), dec!(40.291796960272116003)), (36800, dec!(0.000000000000000000), dec!(37.921691256726697415)), (36780, dec!(0.000000000000000000), dec!(35.551585553181278826)), (36760, dec!(0.000000000000000000), dec!(33.181479849635860238)), (36740, dec!(0.000000000000000000), dec!(30.811374146090441649)), (36720, dec!(0.000000000000000000), dec!(28.441268442545023061)), (36700, dec!(0.000000000000000000), dec!(26.071162738999604472)), (36680, dec!(0.000000000000000000), dec!(23.701057035454185884)), (36660, dec!(0.000000000000000000), dec!(21.330951331908767295)), (36640, dec!(0.000000000000000000), dec!(18.960845628363348707)), (36620, dec!(0.000000000000000000), dec!(16.590739924817930119)), (36600, dec!(0.000000000000000000), dec!(14.220634221272511530)), (36580, dec!(0.000000000000000000), dec!(11.850528517727092942)), (36560, dec!(0.000000000000000000), dec!(9.480422814181674353)), (36540, dec!(0.000000000000000000), dec!(7.110317110636255765)), (36520, dec!(0.000000000000000000), dec!(4.740211407090837176)), (36500, dec!(0.000000000000000000), dec!(2.370105703545418588))], &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(3548.935000000000000000), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(3514.925074192530202853), &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(10870.299837439678675207), &mut vars).expect_commit_success();
    swap(vars.token_y, dec!(499.850000000000000000), &mut vars).expect_commit_success(); 

    let id11 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id11.clone(), dec!(0.011388540033940781), dec!(8.960056056603056633), vec![(37700, dec!(0.000446609413095717), dec!(0.000000000000000000)), (37720, dec!(0.000437494935277437), dec!(0.000000000000000000)), (37740, dec!(0.000428380457459158), dec!(0.000000000000000000)), (37760, dec!(0.000419265979640878), dec!(0.000000000000000000)), (37780, dec!(0.000410151501822598), dec!(0.000000000000000000)), (37800, dec!(0.000401037024004318), dec!(0.000000000000000000)), (37820, dec!(0.000391922546186038), dec!(0.000000000000000000)), (37840, dec!(0.000382808068367758), dec!(0.000000000000000000)), (37860, dec!(0.000373693590549478), dec!(0.000000000000000000)), (37880, dec!(0.000364579112731198), dec!(0.000000000000000000)), (37900, dec!(0.000355464634912918), dec!(0.000000000000000000)), (37920, dec!(0.000346350157094638), dec!(0.000000000000000000)), (37940, dec!(0.000337235679276358), dec!(0.000000000000000000)), (37960, dec!(0.000328121201458078), dec!(0.000000000000000000)), (37980, dec!(0.000319006723639798), dec!(0.000000000000000000)), (38000, dec!(0.000309892245821518), dec!(0.000000000000000000)), (38020, dec!(0.000300777768003238), dec!(0.000000000000000000)), (38040, dec!(0.000291663290184958), dec!(0.000000000000000000)), (38060, dec!(0.000282548812366678), dec!(0.000000000000000000)), (38080, dec!(0.000273434334548398), dec!(0.000000000000000000)), (38100, dec!(0.000264319856730118), dec!(0.000000000000000000)), (38120, dec!(0.000255205378911838), dec!(0.000000000000000000)), (38140, dec!(0.000246090901093558), dec!(0.000000000000000000)), (38160, dec!(0.000236976423275278), dec!(0.000000000000000000)), (38180, dec!(0.000227861945456998), dec!(0.000000000000000000)), (38200, dec!(0.000218747467638718), dec!(0.000000000000000000)), (38220, dec!(0.000209632989820439), dec!(0.000000000000000000)), (38240, dec!(0.000200518512002159), dec!(0.000000000000000000)), (38260, dec!(0.000191404034183879), dec!(0.000000000000000000)), (38280, dec!(0.000182289556365599), dec!(0.000000000000000000)), (38300, dec!(0.000173175078547319), dec!(0.000000000000000000)), (38320, dec!(0.000164060600729039), dec!(0.000000000000000000)), (38340, dec!(0.000154946122910759), dec!(0.000000000000000000)), (38360, dec!(0.000145831645092479), dec!(0.000000000000000000)), (38380, dec!(0.000136717167274199), dec!(0.000000000000000000)), (38400, dec!(0.000127602689455919), dec!(0.000000000000000000)), (38420, dec!(0.000118488211637639), dec!(0.000000000000000000)), (38440, dec!(0.000109373733819359), dec!(0.000000000000000000)), (38460, dec!(0.000100259256001079), dec!(0.000000000000000000)), (38480, dec!(0.000091144778182799), dec!(0.000000000000000000)), (38500, dec!(0.000082030300364519), dec!(0.000000000000000000)), (38520, dec!(0.000072915822546239), dec!(0.000000000000000000)), (38540, dec!(0.000063801344727959), dec!(0.000000000000000000)), (38560, dec!(0.000054686866909679), dec!(0.000000000000000000)), (38580, dec!(0.000045572389091399), dec!(0.000000000000000000)), (38600, dec!(0.000036457911273119), dec!(0.000000000000000000)), (38620, dec!(0.000027343433454839), dec!(0.000000000000000000)), (38640, dec!(0.000018228955636559), dec!(0.000000000000000000)), (38660, dec!(0.000009114477818279), dec!(0.000000000000000000)), (37680, dec!(0.000223304706547858), dec!(8.960056056603056633))], &mut vars).expect_commit_success();
    let id12 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id12.clone(), dec!(0), dec!(491.039943941288964287), vec![(37660, dec!(0.000000000000000000), dec!(19.256468389854469188)), (37640, dec!(0.000000000000000000), dec!(18.871339022057379804)), (37620, dec!(0.000000000000000000), dec!(18.486209654260290421)), (37600, dec!(0.000000000000000000), dec!(18.101080286463201037)), (37580, dec!(0.000000000000000000), dec!(17.715950918666111653)), (37560, dec!(0.000000000000000000), dec!(17.330821550869022269)), (37540, dec!(0.000000000000000000), dec!(16.945692183071932886)), (37520, dec!(0.000000000000000000), dec!(16.560562815274843502)), (37500, dec!(0.000000000000000000), dec!(16.175433447477754118)), (37480, dec!(0.000000000000000000), dec!(15.790304079680664734)), (37460, dec!(0.000000000000000000), dec!(15.405174711883575350)), (37440, dec!(0.000000000000000000), dec!(15.020045344086485967)), (37420, dec!(0.000000000000000000), dec!(14.634915976289396583)), (37400, dec!(0.000000000000000000), dec!(14.249786608492307199)), (37380, dec!(0.000000000000000000), dec!(13.864657240695217815)), (37360, dec!(0.000000000000000000), dec!(13.479527872898128432)), (37340, dec!(0.000000000000000000), dec!(13.094398505101039048)), (37320, dec!(0.000000000000000000), dec!(12.709269137303949664)), (37300, dec!(0.000000000000000000), dec!(12.324139769506860280)), (37280, dec!(0.000000000000000000), dec!(11.939010401709770897)), (37260, dec!(0.000000000000000000), dec!(11.553881033912681513)), (37240, dec!(0.000000000000000000), dec!(11.168751666115592129)), (37220, dec!(0.000000000000000000), dec!(10.783622298318502745)), (37200, dec!(0.000000000000000000), dec!(10.398492930521413361)), (37180, dec!(0.000000000000000000), dec!(10.013363562724323978)), (37160, dec!(0.000000000000000000), dec!(9.628234194927234594)), (37140, dec!(0.000000000000000000), dec!(9.243104827130145210)), (37120, dec!(0.000000000000000000), dec!(8.857975459333055826)), (37100, dec!(0.000000000000000000), dec!(8.472846091535966443)), (37080, dec!(0.000000000000000000), dec!(8.087716723738877059)), (37060, dec!(0.000000000000000000), dec!(7.702587355941787675)), (37040, dec!(0.000000000000000000), dec!(7.317457988144698291)), (37020, dec!(0.000000000000000000), dec!(6.932328620347608907)), (37000, dec!(0.000000000000000000), dec!(6.547199252550519524)), (36980, dec!(0.000000000000000000), dec!(6.162069884753430140)), (36960, dec!(0.000000000000000000), dec!(5.776940516956340756)), (36940, dec!(0.000000000000000000), dec!(5.391811149159251372)), (36920, dec!(0.000000000000000000), dec!(5.006681781362161989)), (36900, dec!(0.000000000000000000), dec!(4.621552413565072605)), (36880, dec!(0.000000000000000000), dec!(4.236423045767983221)), (36860, dec!(0.000000000000000000), dec!(3.851293677970893837)), (36840, dec!(0.000000000000000000), dec!(3.466164310173804453)), (36820, dec!(0.000000000000000000), dec!(3.081034942376715070)), (36800, dec!(0.000000000000000000), dec!(2.695905574579625686)), (36780, dec!(0.000000000000000000), dec!(2.310776206782536302)), (36760, dec!(0.000000000000000000), dec!(1.925646838985446918)), (36740, dec!(0.000000000000000000), dec!(1.540517471188357535)), (36720, dec!(0.000000000000000000), dec!(1.155388103391268151)), (36700, dec!(0.000000000000000000), dec!(0.770258735594178767)), (36680, dec!(0.000000000000000000), dec!(0.385129367797089383))], &mut vars).expect_commit_success(); 
    swap(vars.token_y, dec!(249.925000000000000000), &mut vars).expect_commit_success(); 

    let id13 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id13.clone(), dec!(0.005688045274006818), dec!(5.820108651978365378), vec![(37700, dec!(0.000223060598980660), dec!(0.000000000000000000)), (37720, dec!(0.000218508341858606), dec!(0.000000000000000000)), (37740, dec!(0.000213956084736551), dec!(0.000000000000000000)), (37760, dec!(0.000209403827614497), dec!(0.000000000000000000)), (37780, dec!(0.000204851570492443), dec!(0.000000000000000000)), (37800, dec!(0.000200299313370389), dec!(0.000000000000000000)), (37820, dec!(0.000195747056248334), dec!(0.000000000000000000)), (37840, dec!(0.000191194799126280), dec!(0.000000000000000000)), (37860, dec!(0.000186642542004226), dec!(0.000000000000000000)), (37880, dec!(0.000182090284882171), dec!(0.000000000000000000)), (37900, dec!(0.000177538027760117), dec!(0.000000000000000000)), (37920, dec!(0.000172985770638063), dec!(0.000000000000000000)), (37940, dec!(0.000168433513516008), dec!(0.000000000000000000)), (37960, dec!(0.000163881256393954), dec!(0.000000000000000000)), (37980, dec!(0.000159328999271900), dec!(0.000000000000000000)), (38000, dec!(0.000154776742149846), dec!(0.000000000000000000)), (38020, dec!(0.000150224485027791), dec!(0.000000000000000000)), (38040, dec!(0.000145672227905737), dec!(0.000000000000000000)), (38060, dec!(0.000141119970783683), dec!(0.000000000000000000)), (38080, dec!(0.000136567713661628), dec!(0.000000000000000000)), (38100, dec!(0.000132015456539574), dec!(0.000000000000000000)), (38120, dec!(0.000127463199417520), dec!(0.000000000000000000)), (38140, dec!(0.000122910942295465), dec!(0.000000000000000000)), (38160, dec!(0.000118358685173411), dec!(0.000000000000000000)), (38180, dec!(0.000113806428051357), dec!(0.000000000000000000)), (38200, dec!(0.000109254170929303), dec!(0.000000000000000000)), (38220, dec!(0.000104701913807248), dec!(0.000000000000000000)), (38240, dec!(0.000100149656685194), dec!(0.000000000000000000)), (38260, dec!(0.000095597399563140), dec!(0.000000000000000000)), (38280, dec!(0.000091045142441085), dec!(0.000000000000000000)), (38300, dec!(0.000086492885319031), dec!(0.000000000000000000)), (38320, dec!(0.000081940628196977), dec!(0.000000000000000000)), (38340, dec!(0.000077388371074923), dec!(0.000000000000000000)), (38360, dec!(0.000072836113952868), dec!(0.000000000000000000)), (38380, dec!(0.000068283856830814), dec!(0.000000000000000000)), (38400, dec!(0.000063731599708760), dec!(0.000000000000000000)), (38420, dec!(0.000059179342586705), dec!(0.000000000000000000)), (38440, dec!(0.000054627085464651), dec!(0.000000000000000000)), (38460, dec!(0.000050074828342597), dec!(0.000000000000000000)), (38480, dec!(0.000045522571220542), dec!(0.000000000000000000)), (38500, dec!(0.000040970314098488), dec!(0.000000000000000000)), (38520, dec!(0.000036418056976434), dec!(0.000000000000000000)), (38540, dec!(0.000031865799854380), dec!(0.000000000000000000)), (38560, dec!(0.000027313542732325), dec!(0.000000000000000000)), (38580, dec!(0.000022761285610271), dec!(0.000000000000000000)), (38600, dec!(0.000018209028488217), dec!(0.000000000000000000)), (38620, dec!(0.000013656771366162), dec!(0.000000000000000000)), (38640, dec!(0.000009104514244108), dec!(0.000000000000000000)), (38660, dec!(0.000004552257122054), dec!(0.000000000000000000)), (37680, dec!(0.000111530299490330), dec!(5.820108651978365378))], &mut vars).expect_commit_success(); 

    let id14 = mint_liquidity_receipt(&mut vars);
    add_liquidity_to_receipt(id14.clone(), dec!(0), dec!(244.179891346644342900), vec![(37660, dec!(0.000000000000000000), dec!(9.575682013593895800)), (37640, dec!(0.000000000000000000), dec!(9.384168373322017884)), (37620, dec!(0.000000000000000000), dec!(9.192654733050139968)), (37600, dec!(0.000000000000000000), dec!(9.001141092778262052)), (37580, dec!(0.000000000000000000), dec!(8.809627452506384136)), (37560, dec!(0.000000000000000000), dec!(8.618113812234506220)), (37540, dec!(0.000000000000000000), dec!(8.426600171962628304)), (37520, dec!(0.000000000000000000), dec!(8.235086531690750388)), (37500, dec!(0.000000000000000000), dec!(8.043572891418872472)), (37480, dec!(0.000000000000000000), dec!(7.852059251146994556)), (37460, dec!(0.000000000000000000), dec!(7.660545610875116640)), (37440, dec!(0.000000000000000000), dec!(7.469031970603238724)), (37420, dec!(0.000000000000000000), dec!(7.277518330331360808)), (37400, dec!(0.000000000000000000), dec!(7.086004690059482892)), (37380, dec!(0.000000000000000000), dec!(6.894491049787604976)), (37360, dec!(0.000000000000000000), dec!(6.702977409515727060)), (37340, dec!(0.000000000000000000), dec!(6.511463769243849144)), (37320, dec!(0.000000000000000000), dec!(6.319950128971971228)), (37300, dec!(0.000000000000000000), dec!(6.128436488700093312)), (37280, dec!(0.000000000000000000), dec!(5.936922848428215396)), (37260, dec!(0.000000000000000000), dec!(5.745409208156337480)), (37240, dec!(0.000000000000000000), dec!(5.553895567884459564)), (37220, dec!(0.000000000000000000), dec!(5.362381927612581648)), (37200, dec!(0.000000000000000000), dec!(5.170868287340703732)), (37180, dec!(0.000000000000000000), dec!(4.979354647068825816)), (37160, dec!(0.000000000000000000), dec!(4.787841006796947900)), (37140, dec!(0.000000000000000000), dec!(4.596327366525069984)), (37120, dec!(0.000000000000000000), dec!(4.404813726253192068)), (37100, dec!(0.000000000000000000), dec!(4.213300085981314152)), (37080, dec!(0.000000000000000000), dec!(4.021786445709436236)), (37060, dec!(0.000000000000000000), dec!(3.830272805437558320)), (37040, dec!(0.000000000000000000), dec!(3.638759165165680404)), (37020, dec!(0.000000000000000000), dec!(3.447245524893802488)), (37000, dec!(0.000000000000000000), dec!(3.255731884621924572)), (36980, dec!(0.000000000000000000), dec!(3.064218244350046656)), (36960, dec!(0.000000000000000000), dec!(2.872704604078168740)), (36940, dec!(0.000000000000000000), dec!(2.681190963806290824)), (36920, dec!(0.000000000000000000), dec!(2.489677323534412908)), (36900, dec!(0.000000000000000000), dec!(2.298163683262534992)), (36880, dec!(0.000000000000000000), dec!(2.106650042990657076)), (36860, dec!(0.000000000000000000), dec!(1.915136402718779160)), (36840, dec!(0.000000000000000000), dec!(1.723622762446901244)), (36820, dec!(0.000000000000000000), dec!(1.532109122175023328)), (36800, dec!(0.000000000000000000), dec!(1.340595481903145412)), (36780, dec!(0.000000000000000000), dec!(1.149081841631267496)), (36760, dec!(0.000000000000000000), dec!(0.957568201359389580)), (36740, dec!(0.000000000000000000), dec!(0.766054561087511664)), (36720, dec!(0.000000000000000000), dec!(0.574540920815633748)), (36700, dec!(0.000000000000000000), dec!(0.383027280543755832)), (36680, dec!(0.000000000000000000), dec!(0.191513640271877916))], &mut vars).expect_commit_success(); 
    swap(vars.token_x, dec!(0.299910000000000000), &mut vars).expect_commit_success(); 

    remove_liquidity(id8.clone(), &mut vars).expect_commit_success(); 

    // ASSERT
    remove_liquidity(id5, &mut vars).expect_commit_success();
}

